<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>{{ page.title }} (A Tour of Scala - #{{ page.pageNumber }})</title>
    {% if page.description %}<meta name="description" content="{{ page.description }}">{% endif %}
    <meta name="author" content="{{ site.author.name }}">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
<!--     <link href="{{ ASSET_PATH }}/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
 --><link href="{{ ASSET_PATH }}/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ ASSET_PATH }}/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="{{ ASSET_PATH }}/css/monokai.css" rel="stylesheet" type="text/css" media="all">
    <link rel="stylesheet" href="{{ ASSET_PATH }}/scalakata/webjars/theme/monokai.css">
    <link rel="stylesheet" href="{{ ASSET_PATH }}/scalakata/webjars/theme/solarized.css">
    <link rel="stylesheet" href="{{ ASSET_PATH }}/scalakata/webjars/theme/eclipse.css">
    <link rel="stylesheet" href="{{ ASSET_PATH }}/scalakata/css/kata.css">
    <link rel="stylesheet" href="{{ ASSET_PATH }}/scalakata/css/full-kata.css">
<!--     <link rel="stylesheet" href="{{ ASSET_PATH }}/scalakata/webjars/css/bootstrap.min.css"> -->
    <link rel="stylesheet" href="{{ ASSET_PATH }}/scalakata/webjars/lib/codemirror.css">


    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="{{ BASE_PATH }}{{ site.JB.atom_path }}" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="{{ BASE_PATH }}{{ site.JB.rss_path }}" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

    <style>
      #editor { 
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
      }
      .ace_gutter-active-line {
        /*margin-top: 10px !important;*/
      }
      .ace_gutter, .ace_content {
        /*padding-top: 10px !important;*/
      }
      .bottom-right{
        position: absolute;
        bottom: 0;
        right:0;
        {% if page.showFooter == true %}
        margin-bottom:42px;
        {% else %}
        margin-bottom:10px;
        {% endif %}        
        margin-right: 10px;
        margin-top: 10px;

      }
      #content {
        position: absolute;
        top: 0;
        bottom: 0;
        right: 0;
        margin-top:42px;
        overflow: auto;
        padding-right: 20px;
        border: 0;
        {% if page.showFooter == true %}
        margin-bottom:82px;
        {% else %}
        margin-bottom:60px;
        {% endif %}        

      }
      .navbar {
        min-width: 600px;
      }
      #workspace {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        margin-top:42px;
        overflow: hidden;
        padding: 0;
        border: 0;
        {% if page.showFooter == true %}
        margin-bottom:32px;
        {% endif %}        
      }
      footer {
        font-size: smaller;
        position: absolute;
        bottom: 0;
        border-top:1px solid lightgray;
        height: 32px;
        left: 0;
        right: 0;
        text-align: center;
        line-height: 32px;
        
      }
      code, pre {
        font-size: 15px;
      }
      .page-num {
        font-size: 31px;
        line-height: 26px;
      }
      .page-num.badge-success {
        cursor: pointer;
      }
      .credits a{
        color: white;
        text-decoration: underline;
      }
      .credits {
        background-color: black;
        font-size: 10px;
        position: absolute;
        bottom: 0;
        right: 0;
        padding: 5px;
        color: white;
        opacity: 0.5;
        margin: 10px;
        z-index: 3;
        {% if page.showFooter == true %}
        margin-bottom:32px;
        {% endif %}  
      }
    </style>
  </head>
  <body>
    {% include themes/twitter/header.html %}
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span8">
          <div id="workspace" class="span8">
            <!-- <iframe src="{{ page.scalakata }}" frameborder="0" width="100%" height="100%" style="width:100%;height:100%" scrolling="no"></iframe> -->
            {% include custom/kata.html %}
          </div>
        </div>
        <div class="span4" >
          <div class="span4" id="content">
            <h2><span class="badge page-num">{{ page.pageNumber }}</span> {{ page.title }}</h2>
            {% if page.lead %}
            <p class="lead">{{ page.lead }}</p>
            {% endif %}
            <div>{{ content }}</div>
            {% if page.links %}
              <hr>
              <div>
              <h5>See Also <small> opens in new page</small></h5>
              <ul>
              {% for link in page.links %}
                <li><a href="{{link.url}}" target="_blank">{{link.text}}  <i class="icon icon-share"></i></a>
              {% endfor %}
              </ul>
              </div>
            {% endif %}
            <hr>
            <div class="alert alert-error">
              <strong><i class="icon icon-warning-sign"></i> Note:</strong>
              This is an alpha, incomplete, draft, work in progress effort.
              <br>
              To report errors, comment or contribute please <a href="https://github.com/scalatutorials/scalatutorials.github.io/issues" target="_blank">open an issue</a>
            </div>
                
          </div>
           <div class="bottom-right">
              <ul class="pager">
                <li>
                <a id="toc" href="#">TOC</a>
                </li>
                {% if page.pageNumber > 1 %}
                <li>
                  <a href="{{page.prevPage}}">&#9664; Prev</a>
                </li>
                {% endif %}
                {% if page.isLast != true %}
                <li>
                  <a class="btn-primary" href="{{page.nextPage}}">Next &#9654;</a>
                </li>
                {% endif %}
              </ul>   
           </div>
        </div>

      </div>
    </div>
    <!-- Modal -->
    <div id="tocModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
        <h3 id="myModalLabel">Table of Contents</h3>
      </div>
      <div class="modal-body">
        <ul id="tocList">
        </ul>
      </div>
      <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
        <!-- <button class="btn btn-primary">Save changes</button> -->
      </div>
    </div>
    {% if page.showFooter == true %}
    {% include themes/twitter/footer.html %}
    {% endif %}
    {% include JB/analytics %}

    <script src="{{ ASSET_PATH }}/scalakata/webjars/jquery.min.js" id="jquery"></script>
    <script src="{{ ASSET_PATH }}/scalakata/webjars/codemirror.js"></script>
    <script src="{{ ASSET_PATH }}/scalakata/webjars/clike.js"></script>
    <script src="{{ ASSET_PATH }}/scalakata/js/kata.js"></script>
    <script src="{{ ASSET_PATH }}/bootstrap/js/bootstrap.min.js"></script>
    <script src="{{ ASSET_PATH }}/scalakata/js/ace.js"></script>

    <script>
//TODO: 
//1) move to external JS file
//2) JSLint
//3) "complete" will be checked only when pressing "next"
//4) move to AngularJS, or better handle evnents...
//5) persist on server, not just local storage (unique link?)

        $(function(){
          $(".kata-form").openkata({pushState: false});
          $(".theme-select a").click(function() {
            var value = $(this).data("value");
            selectTheme(value)
          });

          if(localStorage) {
            var theme = localStorage.getItem("theme");
            if(theme) {
              selectTheme(theme);
            }

            var visited = JSON.parse(localStorage.getItem("visited"));
            if (visited &&  visited[location.pathname]) {
              $(".page-num").addClass("badge-success")
              .attr("title","click to unmark as complete")
              .click(function () {
                $(this).removeClass("badge-success").attr("title","");
                delete visited[location.pathname];
                localStorage.setItem("visited", JSON.stringify(visited));
              });
            } else {
              setTimeout(function() {
                if(!visited) {
                  visited = {};
                }
                visited[location.pathname] = true;
                localStorage.setItem("visited", JSON.stringify(visited));
              }, 5*1000); //mark page as visited after 5 seconds
            }
          }

          $("#toc").click(function() {
            $.getJSON("toc.json", function (data) {
              var tocList = $("#tocList");
              tocList.empty();
              $.each(data, function (index, value) {
                var link = $("<a>", {href:value.url}).text(value.title);
                var li = $("<li>").append(link).append(" (" + value.topic + ")");
                tocList.append(li);
                
                if(localStorage) {
                  var url = "/tour/" + value.url;
                  var visited = JSON.parse(localStorage.getItem("visited"));
                  if(visited && visited[url]) {
                    var tick = $("<i>", {"class":"icon icon-ok", title:"click to unmark as complete", "style":"cursor: pointer;"});

                    (function (url) {
                      tick.click (function () {
                        delete visited[url];
                        localStorage.setItem("visited", JSON.stringify(visited));
                        if(url == location.pathname) {
                          $(".page-num").removeClass("badge-success").attr("title",""); //OK, time to AngularJS!
                        }
                        $(this).remove();
                      });
                    }(url));
                    li.append(tick);
                  }
                }
                
              });
              $("#tocModal").modal();
            })
          });

        });

        function selectTheme(theme) {
          //$(".kata-code").data("editor").setOption("theme", theme);
          if(localStorage) {
            //localStorage.setItem("theme", theme);
          }
        }



    </script>
  </body>
</html>
